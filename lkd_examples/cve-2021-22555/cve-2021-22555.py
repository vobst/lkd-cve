import os

sys.path.insert(0, "/" + os.environ["PROJECTE"] + "/lkd_scripts_gdb")

from lkd import session
from lkd import structs
from lkd import breakpoints


class Session(session.GenericSession):
    task = None


class XtCompatTargetFromUserBP(breakpoints.GenericContextBP):
    def _stop(self):
        slab = structs.Slab.from_virtual(gdb.parse_and_eval('t->data').address)
        slab.print_info()
        return True


def main():
    # the name of the poc binary
    comm = "poc"

    XtCompatTargetFromUserBP("net/netfilter/x_tables.c:1130", comm = comm)

    gdb.execute("c")


main()
